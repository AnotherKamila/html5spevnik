<!DOCTYPE html>  <html> <head>   <title>Spevnik.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               Spevnik.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>The really core stuff is defined here.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">Spevnik =</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>almost global almost constants</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">version: </span><span class="s">&#39;0.0.1&#39;</span>
    <span class="nv">debug: </span><span class="kc">true</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>We will have an event-based architecture. The core core core part is
basically just this fact. Here I define the methods for firing events and
attaching event handlers. All message-passing between modules will be done
using these (probably).</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Use this to attach event handlers to events. The callback will get a
single argument: the event object that the sender supplied, if any.</p>

<p>For now only literal event names are supported, but regex support might be
added if the need arises.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">onEvent: </span><span class="nf">(eventName, callback) -&gt;</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&quot;Events  : Adding event listener to `</span><span class="si">#{</span><span class="nx">eventName</span><span class="si">}</span><span class="s">&#39;&quot;</span> <span class="k">if</span> <span class="nx">@debug</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>I am using the <code>window</code> object here rather than creating a custom one
and extending it with Mootools Events. The reason is simply that I do
not know of any drawbacks of doing this.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nb">window</span><span class="p">.</span><span class="nx">addEvent</span> <span class="nx">eventName</span><span class="p">,</span> <span class="nx">callback</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Use this to fire events that other modules can bind to. This is the only
cool way to pass messages between modules. Any relevant data attached to
that event should be passed inside the <code>eventObj</code> object.</p>

<p>Event names should follow the 'eventcategory.eventtype' convention wherever
it makes sense.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">fireEvent: </span><span class="nf">(eventName, eventObj) -&gt;</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&quot;Events  : </span><span class="si">#{</span><span class="nx">eventName</span><span class="si">}</span><span class="s"> has fired.&quot;</span> <span class="k">if</span> <span class="nx">@debug</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">fireEvent</span> <span class="nx">eventName</span><span class="p">,</span> <span class="nx">eventObj</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Initializing is handled by the <code>Loader</code> module. Here we just alias its
<code>init</code> method. I am not using the events system, since (1) it does not
really make sense here, and (2) the order of execution is important at
this stage, so I am explicitly declaring it all in one place instead.</p>

<p>Maybe not using events is not that great, because of hereby introduced
coupling between <code>Loader</code> and other modules (and actually between this
file and <code>Loader</code>, too, which is sad because <code>Loader</code> does not exist yet).
TODO rethink this</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">init: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>We assume that <code>Loader</code> and <code>Loader.init</code> exist. It cannot be checked
here, since they are not loaded at this point.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">@Loader</span><span class="p">.</span><span class="nx">init</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Attach Spevnik to <code>window</code>. The modules will reference this directly.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nb">window</span><span class="p">.</span><span class="nv">Spevnik = </span><span class="nx">Spevnik</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Initialize me as soon as possible, but no sooner.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nb">window</span><span class="p">.</span><span class="nx">addEvent</span> <span class="s">&#39;domready&#39;</span><span class="p">,</span> <span class="o">-&gt;</span>
    <span class="nx">Spevnik</span><span class="p">.</span><span class="nx">init</span><span class="p">()</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 